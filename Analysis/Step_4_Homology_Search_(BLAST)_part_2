from Bio.Blast import NCBIXML
from Bio import SeqIO
from Bio.Blast import NCBIWWW
import ssl
from Bio.SeqRecord import SeqRecord
#from Bio import Entrez
#Entrez.email = "sameenkhaled@gmail.com"

ssl._create_default_https_context = ssl._create_unverified_context

# Step 1: Parse BLAST results
with open("blast_results.xml") as handle:
    blast_records = list(NCBIXML.parse(handle))
blast_record = blast_records[0]

# Step 2: Collect all hits with similarity info
similarity_results = []

#for alignment in blast_record.alignments:

for alignment in blast_record.alignments:
    print("\nHomolog:", alignment.title)
    print("Length:", alignment.length)

    for hsp in alignment.hsps:
        print(" E-value:", hsp.expect)
        print(" HSP score:", hsp.bits)
        print(" Identity:", hsp.identities, "/", hsp.align_length)
        print(" Query region:", hsp.query_start, "-", hsp.query_end)
        print(" Subject region:", hsp.sbjct_start, "-", hsp.sbjct_end)




# Step 3: Sort by identity (descending)
similarity_results.sort(key=lambda x: x["identity"], reverse=True)

# Step 4: Print or save
print("Similarity search results (top hits):")
for res in similarity_results[:20]:  # top 20
    print(f"{res['title']}, Identity: {res['identity']:.2%}, Bit score: {res['bit_score']}, E-value: {res['evalue']}")
